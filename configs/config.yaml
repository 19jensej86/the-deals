# DealFinder Configuration - v7.0 (Claude Edition + Detail Scraping)
# ===================================================================

# RUNTIME MODE - Controls test vs production behavior
# ====================================================
runtime:
  mode: prod # "test" or "prod" - SINGLE SOURCE OF TRUTH

general:
  user_agent: "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/128.0.0.0 Safari/537.36"
  request_timeout_sec: 18
  max_pages_list: 1
  max_listings_per_query: 8
  exclude_terms: ["defekt", "kaputt", "ersatzteil", "bastler", "für bastler"]
  autoclean_days: 30
  car_model: "VW Touran"

  # v7.0: Detail Page Scraping
  # --------------------------
  # Scrapes additional data (seller rating, shipping cost, pickup)
  # from detail pages of top deals.
  # NO AI COSTS - only browser scraping!
  detail_pages_enabled: true
  max_detail_pages_per_run: 5 # Top 5 by expected_profit

  # v9.0: Clarity Detection & Smart Scraping
  # ----------------------------------------
  # Automatically detects unclear listings and scrapes detail pages
  # to get more info. Uses vision as fallback for still-unclear items.
  clarity_detection_enabled: true
  max_unclear_detail_scrapes: 10 # Max detail pages for unclear listings
  max_vision_for_clarity: 5 # Max vision calls for still-unclear items

  # Detail Scraping
  detail_scraping:
    enabled: true

  # Vision
  vision:
    enabled: true

  # v9.2: AI-based Title Normalization
  # ----------------------------------
  # Uses AI instead of regex for title cleanup and bundle detection.
  # Much better for multilingual titles and edge cases.
  # Cost: ~0.002 CHF per 10 titles (Haiku)
  ai_title_normalization: true

postgres:
  host: "localhost"
  port: 5432
  db: "dealfinder"
  user: "dealuser"
  password: "dealsecret"

db:
  clear_on_start: false
  truncate_on_start: false
  clear_runs_only: false

cache:
  enabled: true
  clear_on_start: false
  persist: true
  variant_cache_days: 7 # Conservative: 7 days for variant info
  component_cache_days: 7 # Conservative: 7 days for components
  cluster_cache_days: 3 # Conservative: 3 days for clusters
  web_price_cache_days: 3 # Conservative: 3 days for web prices (market changes fast)

profit:
  ricardo_fee_percent: 0.10
  shipping_cost_chf: 10.0 # Realistic default shipping cost
  min_profit_threshold: 10.0 # Minimum 10 CHF profit required

bundle:
  enabled: false # DISABLED - bundles out of scope
  discount_percent: 0.10
  min_component_value: 10.0
  use_vision_for_unclear: false

search:
  # PROD QUERIES - High-quality liquid products (NO bundles/sets)
  # ==============================================================
  # Selection criteria:
  # - Single products only (no bundles, no sets, no accessories-only)
  # - Liquid Swiss second-hand market (many listings, real demand)
  # - Clear product identification (model numbers, generations)
  # - Realistic profit potential (15-25% margins typical)
  queries:
    - "Bosch Schlagbohrmaschine"
    - "LEGO Star Wars Millennium Falcon"
    - "Nike Air Zoom Pegasus 39"
    - "Canon EOS R6 Mark II"

# =================================================
# AI Configuration - v7.0 CLAUDE
# =================================================
ai:
  # Provider selection: "claude" or "openai"
  provider: "claude"

  # Claude models
  # NOTE: Haiku 4.5 (20250514) not yet available - using Haiku 3.5
  claude_model_fast: "claude-3-5-haiku-20241022" # Haiku 3.5 - Für schnelle Tasks (clustering, evaluation)
  claude_model_web: "claude-sonnet-4-20250514" # Sonnet 4 - Für Web-Search (Neupreise)

  # OpenAI fallback (falls Claude nicht verfügbar)
  openai_model: "gpt-4o-mini"

  # General settings
  use_ai_text: true
  use_ai_vision: true
  temperature: 0.2
  adaptive_vision_rate: 0.10

  # v7.0: Web Search Settings
  # ⚠️ WARNING: Web search costs ~$0.35 per batch!
  # Set to false to use AI estimation only (much cheaper with Haiku 4.5: ~$0.14/run)
  # NOTE: Shops are selected dynamically by AI based on product category
  #       No need to hardcode shop lists - AI chooses best shops automatically
  web_search:
    enabled: true # Set to FALSE to disable expensive web searches
    max_calls_per_run: null # Allow per distinct product
    batch_enabled: true

  # AI Fallback Pricing
  ai_fallback_pricing:
    enabled: true

  # Pricing (USD pro Call) - UPDATED 2026-01-20 for Haiku 4.5
  pricing:
    claude_haiku_usd: 0.008 # Haiku 4.5: ~2k tokens × $4/1M (4x increase)
    claude_sonnet_usd: 0.005 # Sonnet 4: ~1.5k tokens × $3/1M
    claude_web_search_usd: 0.35 # Sonnet 4 + web: ~22k tokens = $0.35
    openai_text_usd: 0.001
    vision_usd: 0.007

  # Budget limits
  budget:
    enforce: true
    max_total_usd: 2.00
    daily_cost_usd_max: 5.00 # Increased 10x for testing (was 0.50)
    daily_vision_calls_max: 100
    daily_web_search_max: 100 # Increased 10x for testing (was 10)
