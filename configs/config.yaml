# DealFinder Configuration - v7.0 (Claude Edition + Detail Scraping)
# ===================================================================

# RUNTIME MODE - Controls test vs production behavior
# ====================================================
runtime:
  mode: test # "test" or "prod" - SINGLE SOURCE OF TRUTH

general:
  user_agent: "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/128.0.0.0 Safari/537.36"
  request_timeout_sec: 18
  max_pages_list: 1
  max_listings_per_query: 8
  exclude_terms: ["defekt", "kaputt", "ersatzteil", "bastler", "für bastler"]
  autoclean_days: 30
  car_model: "VW Touran"

  # v7.0: Detail Page Scraping
  # --------------------------
  # Scrapes additional data (seller rating, shipping cost, pickup)
  # from detail pages of top deals.
  # NO AI COSTS - only browser scraping!
  detail_pages_enabled: true
  max_detail_pages_per_run: 5 # Top 5 by expected_profit

  # v9.0: Clarity Detection & Smart Scraping
  # ----------------------------------------
  # Automatically detects unclear listings and scrapes detail pages
  # to get more info. Uses vision as fallback for still-unclear items.
  clarity_detection_enabled: true
  max_unclear_detail_scrapes: 10 # Max detail pages for unclear listings
  max_vision_for_clarity: 5 # Max vision calls for still-unclear items

  # v9.2: AI-based Title Normalization
  # ----------------------------------
  # Uses AI instead of regex for title cleanup and bundle detection.
  # Much better for multilingual titles and edge cases.
  # Cost: ~0.002 CHF per 10 titles (Haiku)
  ai_title_normalization: true

postgres:
  host: "localhost"
  port: 5432
  db: "dealfinder"
  user: "dealuser"
  password: "dealsecret"

db:
  clear_on_start: true

cache:
  enabled: true
  clear_on_start: true
  variant_cache_days: 30
  component_cache_days: 30
  cluster_cache_days: 7
  web_price_cache_days: 60

profit:
  ricardo_fee_percent: 0.10
  shipping_cost_chf: 0.0
  min_profit_threshold: 10.0 # v7.2.1: Lowered from 20.0 to capture more deals

bundle:
  enabled: true
  discount_percent: 0.10
  min_component_value: 10.0
  use_vision_for_unclear: true

search:
  # TEST QUERIES - Controlled set for testing
  # ==========================================
  # These queries test key scenarios:
  # 1. Accessory detection (Apple Watch Armband)
  # 2. High-confidence product (AirPods Pro 2)
  # 3. Bundle logic (Hantelscheiben Set)
  # 4. Standard product (iPhone 12 Mini)
  queries:
    - "Apple Watch Ultra Armband original"
    - "Apple AirPods Pro 2. Generation"
    - "Olympic Hantelscheiben Set 4x5kg"
    - "iPhone 12 Mini 128GB"

# =================================================
# AI Configuration - v7.0 CLAUDE
# =================================================
ai:
  # Provider selection: "claude" or "openai"
  provider: "claude"

  # Claude models
  # UPDATED 2026-01-20: Haiku 3.5 deprecated, migrated to Haiku 4.5
  claude_model_fast: "claude-3-5-haiku-20250514" # Haiku 4.5 - Für schnelle Tasks (clustering, evaluation)
  claude_model_web: "claude-sonnet-4-20250514" # Sonnet 4 - Für Web-Search (Neupreise)

  # OpenAI fallback (falls Claude nicht verfügbar)
  openai_model: "gpt-4o-mini"

  # General settings
  use_ai_text: true
  use_ai_vision: true
  temperature: 0.2
  adaptive_vision_rate: 0.10

  # v7.0: Web Search Settings
  # ⚠️ WARNING: Web search costs ~$0.35 per batch!
  # Set to false to use AI estimation only (much cheaper with Haiku 4.5: ~$0.14/run)
  # NOTE: Shops are selected dynamically by AI based on product category
  #       No need to hardcode shop lists - AI chooses best shops automatically
  web_search:
    enabled: true # Set to FALSE to disable expensive web searches

  # Pricing (USD pro Call) - UPDATED 2026-01-20 for Haiku 4.5
  pricing:
    claude_haiku_usd: 0.008 # Haiku 4.5: ~2k tokens × $4/1M (4x increase)
    claude_sonnet_usd: 0.005 # Sonnet 4: ~1.5k tokens × $3/1M
    claude_web_search_usd: 0.35 # Sonnet 4 + web: ~22k tokens = $0.35
    openai_text_usd: 0.001
    vision_usd: 0.007

  # Budget limits
  budget:
    daily_cost_usd_max: 5.00 # Increased 10x for testing (was 0.50)
    daily_vision_calls_max: 100
    daily_web_search_max: 100 # Increased 10x for testing (was 10)
